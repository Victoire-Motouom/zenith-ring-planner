import{c as Q,j as e,b as W,n as J,P as R,u as Z,l as M,m as H,A as ee,e as P,t as S,d as N,C as te,g as ae,h as se,E as re,i as ne,B as ce}from"./index-lTdGCpIu.js";import{r as c}from"./react-DDKPen9N.js";import{u as A}from"./vendor-DL6J-QeD.js";import{a as oe,I as ie}from"./index-DhhcdYEa.js";import{C as de,S as F,a as B,b as T,c as q,d as E}from"./select-BzZ03Uuw.js";import{S as le}from"./scroll-area-D7EBtxih.js";import"./index-BdQq_4o_.js";import"./index-7-W3I3yl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=Q("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);var I="Checkbox",[he,Ne]=W(I),[pe,D]=he(I);function me(a){const{__scopeCheckbox:d,checked:n,children:f,defaultChecked:o,disabled:s,form:m,name:u,onCheckedChange:h,required:g,value:C="on",internal_do_not_use_render:x}=a,[b,t]=Z({prop:n,defaultProp:o??!1,onChange:h,caller:I}),[r,p]=c.useState(null),[v,i]=c.useState(null),l=c.useRef(!1),w=r?!!m||!!r.closest("form"):!0,k={checked:b,disabled:s,setChecked:t,control:r,setControl:p,name:u,form:m,value:C,hasConsumerStoppedPropagationRef:l,required:g,defaultChecked:j(o)?!1:o,isFormControl:w,bubbleInput:v,setBubbleInput:i};return e.jsx(pe,{scope:d,...k,children:xe(x)?x(k):f})}var O="CheckboxTrigger",L=c.forwardRef(({__scopeCheckbox:a,onKeyDown:d,onClick:n,...f},o)=>{const{control:s,value:m,disabled:u,checked:h,required:g,setControl:C,setChecked:x,hasConsumerStoppedPropagationRef:b,isFormControl:t,bubbleInput:r}=D(O,a),p=M(o,C),v=c.useRef(h);return c.useEffect(()=>{const i=s==null?void 0:s.form;if(i){const l=()=>x(v.current);return i.addEventListener("reset",l),()=>i.removeEventListener("reset",l)}},[s,x]),e.jsx(R.button,{type:"button",role:"checkbox","aria-checked":j(h)?"mixed":h,"aria-required":g,"data-state":V(h),"data-disabled":u?"":void 0,disabled:u,value:m,...f,ref:p,onKeyDown:H(d,i=>{i.key==="Enter"&&i.preventDefault()}),onClick:H(n,i=>{x(l=>j(l)?!0:!l),r&&t&&(b.current=i.isPropagationStopped(),b.current||i.stopPropagation())})})});L.displayName=O;var _=c.forwardRef((a,d)=>{const{__scopeCheckbox:n,name:f,checked:o,defaultChecked:s,required:m,disabled:u,value:h,onCheckedChange:g,form:C,...x}=a;return e.jsx(me,{__scopeCheckbox:n,checked:o,defaultChecked:s,disabled:u,required:m,onCheckedChange:g,name:f,form:C,value:h,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(L,{...x,ref:d,__scopeCheckbox:n}),b&&e.jsx(U,{__scopeCheckbox:n})]})})});_.displayName=I;var z="CheckboxIndicator",$=c.forwardRef((a,d)=>{const{__scopeCheckbox:n,forceMount:f,...o}=a,s=D(z,n);return e.jsx(J,{present:f||j(s.checked)||s.checked===!0,children:e.jsx(R.span,{"data-state":V(s.checked),"data-disabled":s.disabled?"":void 0,...o,ref:d,style:{pointerEvents:"none",...a.style}})})});$.displayName=z;var G="CheckboxBubbleInput",U=c.forwardRef(({__scopeCheckbox:a,...d},n)=>{const{control:f,hasConsumerStoppedPropagationRef:o,checked:s,defaultChecked:m,required:u,disabled:h,name:g,value:C,form:x,bubbleInput:b,setBubbleInput:t}=D(G,a),r=M(n,t),p=oe(s),v=ee(f);c.useEffect(()=>{const l=b;if(!l)return;const w=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(w,"checked").set,X=!o.current;if(p!==s&&y){const Y=new Event("click",{bubbles:X});l.indeterminate=j(s),y.call(l,j(s)?!1:s),l.dispatchEvent(Y)}},[b,p,s,o]);const i=c.useRef(j(s)?!1:s);return e.jsx(R.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??i.current,required:u,disabled:h,name:g,value:C,form:x,...d,tabIndex:-1,ref:r,style:{...d.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});U.displayName=G;function xe(a){return typeof a=="function"}function j(a){return a==="indeterminate"}function V(a){return j(a)?"indeterminate":a?"checked":"unchecked"}const K=c.forwardRef(({className:a,...d},n)=>e.jsx(_,{ref:n,className:P("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...d,children:e.jsx($,{className:P("flex items-center justify-center text-current"),children:e.jsx(de,{className:"h-4 w-4"})})}));K.displayName=_.displayName;const we=()=>{const[a,d]=c.useState(""),[n,f]=c.useState("daily"),[o,s]=c.useState("general"),m=A(()=>N.habits.orderBy("createdAt").toArray(),[]),u=new Date().toISOString().slice(0,10),h=A(()=>N.habitEntries.where({date:u}).toArray(),[u])||[],g=new Set(h.filter(t=>t.completed).map(t=>t.habitId)),C=c.useCallback(async()=>{if(a.trim()===""){S({title:"Habit name cannot be empty",variant:"destructive"});return}try{await N.habits.add({name:a,frequency:n,category:o,createdAt:new Date}),d(""),S({title:"Habit Added",description:`Your new ${n} habit has been saved.`})}catch(t){console.error("Failed to add habit:",t),S({title:"Error",description:"Could not save your habit.",variant:"destructive"})}},[a,n,o]),x=c.useCallback(async(t,r)=>{try{const p=await N.habitEntries.where({habitId:t,date:u}).first();p?await N.habitEntries.update(p.id,{completed:r}):await N.habitEntries.add({habitId:t,date:u,completed:r}),S({title:r?"Habit Completed!":"Habit Unchecked",description:"Your progress has been saved."})}catch(p){console.error("Failed to update habit entry:",p),S({title:"Error",description:"Could not save your progress.",variant:"destructive"})}},[u]),b=c.useCallback(t=>{const r=new Set(h.filter(y=>y.habitId===t&&y.completed).map(y=>y.date));if(r.size===0)return 0;let p=0;const v=new Date,i=v.toISOString().slice(0,10),l=new Date;l.setDate(v.getDate()-1);const w=l.toISOString().slice(0,10);let k=new Date;if(!r.has(i)&&!r.has(w))return 0;for(r.has(i)||k.setDate(k.getDate()-1);;){const y=k.toISOString().slice(0,10);if(r.has(y))p++,k.setDate(k.getDate()-1);else break}return p},[h]);return e.jsxs(te,{className:"w-full",children:[e.jsxs(ae,{children:[e.jsx(se,{children:"Habit Tracker"}),e.jsx(re,{children:"The Earth Ring: Cultivate discipline by tracking your habits."})]}),e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col gap-4 p-4 border rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Create New Habit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ie,{placeholder:"e.g., Review budget, exercise...",value:a,onChange:t=>d(t.target.value),className:"md:col-span-2"}),e.jsxs(F,{value:n,onValueChange:t=>f(t),children:[e.jsx(B,{children:e.jsx(T,{placeholder:"Frequency"})}),e.jsxs(q,{children:[e.jsx(E,{value:"daily",children:"Daily"}),e.jsx(E,{value:"weekly",children:"Weekly"}),e.jsx(E,{value:"monthly",children:"Monthly"})]})]}),e.jsxs(F,{value:o,onValueChange:t=>s(t),children:[e.jsx(B,{children:e.jsx(T,{placeholder:"Category"})}),e.jsxs(q,{children:[e.jsx(E,{value:"general",children:"General"}),e.jsx(E,{value:"financial",children:"Financial"})]})]})]}),e.jsx(ce,{onClick:C,className:"self-end",children:"Add Habit"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"My Habits"}),e.jsx(le,{className:"h-[400px] w-full pr-4",children:e.jsx("div",{className:"space-y-4",children:m&&m.length>0?m.map(t=>e.jsxs("div",{className:"p-4 bg-muted rounded-lg flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(K,{id:`habit-${t.id}`,checked:g.has(t.id),onCheckedChange:r=>x(t.id,!!r)}),e.jsx("label",{htmlFor:`habit-${t.id}`,className:"font-medium",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-orange-500",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"font-bold text-sm",children:b(t.id)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded-full ${t.category==="financial"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.category}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize w-16 text-right",children:t.frequency})]})]})]},t.id)):e.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[e.jsx("p",{children:"No habits defined yet."}),e.jsx("p",{className:"text-xs",children:"Add a new habit to start building discipline."})]})})})]})]})]})};export{we as default};
