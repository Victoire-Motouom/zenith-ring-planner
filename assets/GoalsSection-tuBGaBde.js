import{c as re,j as e,B as o,C as f,i as j,T as B,g as N,h as w,k as V,d as c,t as n}from"./index-BvYtcx4O.js";import{B as ie}from"./badge-hljSvVAe.js";import{I as h}from"./index-MPzi5exS.js";import{L as m}from"./label-3o7zzb95.js";import{T as ne}from"./textarea-SadhOi5D.js";import{P as Y,D as F,a as P,b as k,c as E,d as I,e as q}from"./dialog-0t7jHfb4.js";import{S as le,a as oe,b as de,c as ce,d as W}from"./select-C012jyCn.js";import{r as i}from"./react-DDKPen9N.js";import{T as me}from"./trash-2-Dvzf2diV.js";import{T as ue}from"./trending-up-DKHjy3CO.js";import"./vendor-DL6J-QeD.js";import"./index-BdQq_4o_.js";import"./index-DUopk3yw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=re("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function Ae(){const[u,H]=i.useState([]),[K,p]=i.useState(!1),[J,v]=i.useState(!1),[b,$]=i.useState(!1),[r,S]=i.useState(null),[M,Q]=i.useState([]),[C,U]=i.useState(""),[D,G]=i.useState(""),[A,L]=i.useState(!1),[a,d]=i.useState({title:"",description:"",targetAmount:"",currentAmount:"0",targetDate:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],category:"financial",reminderDate:""}),T=async()=>{try{const t=await c.goals.toArray(),x=(await c.transactions.where("type").equals("income").and(l=>!!l.goalId).toArray()).reduce((l,g)=>(g.goalId&&(l[g.goalId]=(l[g.goalId]||0)+g.amount),l),{}),z=t.map(l=>{const g=x[l.id]||0,se=l.currentAmount+g;return{...l,linkedAmount:g,totalProgress:se}});H(z)}catch(t){console.error("Error loading goals:",t),n({title:"Error",description:"Failed to load goals. Please try again.",variant:"destructive"})}},y=async t=>{try{const s=await c.strategicSteps.where("goalId").equals(t).toArray();Q(s)}catch(s){console.error("Error loading strategic steps:",s),n({title:"Error",description:"Failed to load strategic steps.",variant:"destructive"})}};i.useEffect(()=>{T()},[]),i.useEffect(()=>{r&&b&&y(r.id)},[r,b]);const X=async t=>{if(t.preventDefault(),!a.title||!a.targetAmount){n({title:"Missing Information",description:"Please fill in all required fields.",variant:"destructive"});return}L(!0);try{await c.goals.add({title:a.title,description:a.description,targetAmount:parseFloat(a.targetAmount),currentAmount:parseFloat(a.currentAmount)||0,targetDate:new Date(a.targetDate),category:a.category,reminderDate:a.reminderDate?new Date(a.reminderDate):void 0,reminderSent:!1,createdAt:new Date}),n({title:"Goal Created",description:"Your goal has been successfully created."}),d({title:"",description:"",targetAmount:"",currentAmount:"0",targetDate:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],category:"financial",reminderDate:""}),p(!1),await T()}catch(s){console.error("Error creating goal:",s),n({title:"Error",description:"Failed to create goal. Please try again.",variant:"destructive"})}finally{L(!1)}},O=async()=>{if(!(!C||!r))try{await c.strategicSteps.add({goalId:r.id,title:C,isCompleted:!1,createdAt:new Date}),U(""),await y(r.id)}catch(t){console.error("Error adding step:",t),n({title:"Error",description:"Failed to add step.",variant:"destructive"})}},Z=async t=>{try{await c.strategicSteps.update(t.id,{isCompleted:!t.isCompleted}),await y(t.goalId)}catch(s){console.error("Error updating step:",s),n({title:"Error",description:"Failed to update step.",variant:"destructive"})}},_=async t=>{if(r)try{await c.strategicSteps.delete(t),await y(r.id)}catch(s){console.error("Error deleting step:",s),n({title:"Error",description:"Failed to delete step.",variant:"destructive"})}},ee=async()=>{if(!r||!D){n({title:"Missing Information",description:"Please enter an amount to add.",variant:"destructive"});return}try{const t=r.currentAmount+parseFloat(D);await c.goals.update(r.id,{currentAmount:t}),n({title:"Progress Updated",description:`Your progress for "${r.title}" has been updated.`}),v(!1),S(null),G(""),await T()}catch(t){console.error("Error updating goal progress:",t),n({title:"Error",description:"Failed to update progress. Please try again.",variant:"destructive"})}},te=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),ae=(t,s)=>Math.min(t/s*100,100),R=t=>{const s=new Date,x=t.getTime()-s.getTime();return Math.ceil(x/(1e3*60*60*24))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-earth bg-clip-text text-transparent",children:"Goals & Vision"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Fire Ring - Decisive action toward your destiny"})]}),e.jsxs(o,{variant:"earth",className:"gap-2",onClick:()=>p(!0),children:[e.jsx(Y,{className:"h-4 w-4"}),"Set New Goal"]})]}),u.length===0?e.jsx(f,{className:"shadow-soft",children:e.jsxs(j,{className:"text-center py-12",children:[e.jsx(B,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Forge Your Path"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Set clear goals and pursue them with the determination of a samurai. Every goal is a battle to be won."}),e.jsxs(o,{variant:"earth",className:"gap-2",onClick:()=>p(!0),children:[e.jsx(Y,{className:"h-4 w-4"}),"Create Your First Goal"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:u.map(t=>{const s=ae(t.totalProgress,t.targetAmount),x=R(t.targetDate);return e.jsxs(f,{className:"shadow-soft hover:shadow-zenith transition-all duration-300",children:[e.jsx(N,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(w,{className:"text-lg",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description})]}),e.jsx(ie,{variant:t.category==="financial"?"default":"secondary",className:"capitalize",children:t.category})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"font-medium text-earth-ring",children:[s.toFixed(1),"%"]})]}),e.jsx("div",{className:"relative h-3 w-full bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-earth-ring/70 to-earth-ring rounded-full transition-all duration-500 ease-out",style:{width:`${s}%`}})}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsxs("span",{className:"text-2xl font-bold text-primary",children:["$",t.totalProgress.toLocaleString()]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ $",t.targetAmount.toLocaleString()]})]}),t.linkedAmount>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Includes $",t.linkedAmount.toLocaleString()," from linked income."]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:x>0?`${x} days remaining`:"Goal deadline passed"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(o,{variant:"outline",size:"sm",className:"flex-1","aria-label":`Update progress for ${t.title}`,onClick:()=>{S(t),v(!0)},children:"Update Progress"}),e.jsx(o,{variant:"earth",size:"sm",className:"flex-1","aria-label":`View strategic plan for ${t.title}`,onClick:()=>{S(t),$(!0)},children:"Strategic Plan"})]})]})]},t.id)})}),e.jsx(F,{open:J,onOpenChange:v,children:e.jsxs(P,{children:[e.jsxs(k,{children:[e.jsxs(E,{children:['Update Progress for "',r==null?void 0:r.title,'"']}),e.jsx(I,{children:"Add to your current progress. Every step counts!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"amount-to-add",children:"Amount to Add"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-muted-foreground",children:"$"}),e.jsx(h,{id:"amount-to-add",type:"number",step:"0.01",placeholder:"50.00",value:D,onChange:t=>G(t.target.value),className:"pl-7"})]})]}),e.jsxs(q,{children:[e.jsx(o,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(o,{variant:"earth",onClick:ee,children:"Update"})]})]})}),e.jsx(F,{open:b,onOpenChange:$,children:e.jsxs(P,{className:"max-h-[80vh] flex flex-col",children:[e.jsxs(k,{children:[e.jsxs(E,{children:["Strategic Plan: ",r==null?void 0:r.title]}),e.jsx(I,{children:"Break down your goal into actionable steps."})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 space-y-2",children:[M.map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-md bg-muted/50",children:[e.jsx("button",{onClick:()=>Z(t),"aria-label":`Toggle step ${t.title}`,children:e.jsx(ge,{className:`h-5 w-5 transition-colors ${t.isCompleted?"text-green-500":"text-muted-foreground"}`})}),e.jsx("span",{className:`flex-grow ${t.isCompleted?"line-through text-muted-foreground":""}`,children:t.title}),e.jsx("button",{onClick:()=>_(t.id),"aria-label":`Delete step ${t.title}`,children:e.jsx(me,{className:"h-4 w-4 text-destructive/70 hover:text-destructive"})})]},t.id)),M.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No steps created yet. Add your first step below!"})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(h,{placeholder:"Add a new strategic step...",value:C,onChange:t=>U(t.target.value),onKeyDown:t=>t.key==="Enter"&&O()}),e.jsx(o,{onClick:O,variant:"earth",children:"Add Step"})]})]})}),u.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(f,{className:"bg-gradient-subtle shadow-soft",children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium text-muted-foreground",children:"Active Goals"}),e.jsx(B,{className:"h-4 w-4 text-fire-ring"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-fire-ring",children:u.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"goals currently in pursuit"})]})]}),e.jsxs(f,{className:"bg-gradient-subtle shadow-soft",children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium text-muted-foreground",children:"Total Progress"}),e.jsx(ue,{className:"h-4 w-4 text-fire-ring"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-fire-ring",children:te(u.reduce((t,s)=>t+s.currentAmount,0))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"contributed across all goals"})]})]}),e.jsxs(f,{className:"bg-gradient-subtle shadow-soft",children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium text-muted-foreground",children:"Avg. Days Remaining"}),e.jsx(V,{className:"h-4 w-4 text-fire-ring"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-fire-ring",children:Math.round(u.reduce((t,s)=>t+R(s.targetDate),0)/u.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"average time to reach targets"})]})]})]}),e.jsx(F,{open:K,onOpenChange:p,children:e.jsx(P,{className:"sm:max-w-[525px]",children:e.jsxs("form",{onSubmit:X,children:[e.jsxs(k,{children:[e.jsx(E,{children:"Set New Goal"}),e.jsx(I,{children:"Define your goal with clarity and purpose. What do you want to achieve?"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"goal-title",children:"Title"}),e.jsx(h,{id:"goal-title",value:a.title,onChange:t=>d({...a,title:t.target.value}),placeholder:"e.g., Save for Vacation"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"goal-description",children:"Description"}),e.jsx(ne,{id:"goal-description",value:a.description,onChange:t=>d({...a,description:t.target.value}),placeholder:"Why is this goal important to you?",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"goal-targetAmount",children:"Target Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-muted-foreground",children:"$"}),e.jsx(h,{id:"goal-targetAmount",type:"number",value:a.targetAmount,onChange:t=>d({...a,targetAmount:t.target.value}),placeholder:"0.00",className:"pl-8",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"goal-currentAmount",children:"Current Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-muted-foreground",children:"$"}),e.jsx(h,{id:"goal-currentAmount",type:"number",value:a.currentAmount,onChange:t=>d({...a,currentAmount:t.target.value}),placeholder:"0.00",className:"pl-8",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"goal-category",children:"Category"}),e.jsxs(le,{value:a.category,onValueChange:t=>d({...a,category:t}),children:[e.jsx(oe,{id:"goal-category",children:e.jsx(de,{placeholder:"Select category"})}),e.jsxs(ce,{children:[e.jsx(W,{value:"financial",children:"Financial"}),e.jsx(W,{value:"personal",children:"Personal"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"goal-targetDate",children:"Target Date"}),e.jsx(h,{id:"goal-targetDate",type:"date",value:a.targetDate,onChange:t=>d({...a,targetDate:t.target.value}),min:new Date().toISOString().split("T")[0]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"reminder-date",children:"Reminder (Optional)"}),e.jsx(h,{id:"reminder-date",type:"datetime-local",value:a.reminderDate,onChange:t=>d({...a,reminderDate:t.target.value})})]})]}),e.jsxs(q,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:A,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:A,children:A?"Creating...":"Create Goal"})]})]})})})]})}export{Ae as default};
